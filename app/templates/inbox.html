<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <title>Skrzynka odbiorcza</title> 
    
</head>
<body>

<div class="container wide-container">
            <h2>Twoja zaszyfrowana skrzynka</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
    <div class="header-actions">
        <a href="{{ url_for('messages.send_message') }}" class="btn-compose">
            + Nowa wiadomoÅ›Ä‡
        </a>
        <a href="{{ url_for('auth.logout') }}" style="color: #dc3545; margin-left: 20px;">Wyloguj siÄ™</a>
    </div>

    <table class="message-table">
        <thead>
            <tr>
                <th>Status</th>
                <th>Nadawca</th>
                <th>Data otrzymania</th>
                <th>Opcje</th>
            </tr>
        </thead>
        <tbody>
            {% for recipient_msg in messages %}
                {# recipient_msg to obiekt RecipientMessage #}
                {# recipient_msg.message to powiÄ…zany obiekt Message #}
                <tr class="{{ 'unread' if not recipient_msg.is_read else '' }}">
                    <td>
                        {% if not recipient_msg.is_read %}
                            <span class="status-badge badge-new">Nowa</span>
                        {% else %}
                            <span class="status-badge badge-read">Przeczytana</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ recipient_msg.message.sender.email }}
                    </td>
                    <td>
                        {{ recipient_msg.message.created_at.strftime('%d.%m.%Y %H:%M') }}
                    </td>
                    <td>
                        <a href="{{ url_for('messages.view_message', msg_id=recipient_msg.message_id) }}" class="btn-view">
                            OtwÃ³rz wiadomoÅ›Ä‡
                        </a>
                        <form action="{{ url_for('messages.delete_message', msg_id=recipient_msg.message_id) }}" 
                        method="POST" style="display:inline;" 
                        onsubmit="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tÄ™ wiadomoÅ›Ä‡?');">
                        <button type="submit" style="background:none; border:none; color:#dc3545; cursor:pointer; font-weight:500;">
                                    UsuÅ„
                        </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4" class="empty-state">
                        <span class="no-messages-icon">ðŸ“¥</span>
                        Brak wiadomoÅ›ci w skrzynce odbiorczej.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</body>
</html>